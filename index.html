<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard IoT ESP32</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <style>
    :root {
      --primary: #3498db;
      --primary-dark: #2980b9;
      --secondary: #2ecc71;
      --secondary-dark: #27ae60;
      --danger: #e74c3c;
      --danger-dark: #c0392b;
      --dark: #2c3e50;
      --light: #ecf0f1;
      --gray: #7f8c8d;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1a2980, #26d0ce);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      width: 100%;
      max-width: 450px;
    }

    .box {
      background-color: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 40px 30px;
      box-shadow: var(--shadow), 0 10px 30px rgba(0, 0, 0, 0.2);
      transition: var(--transition);
      overflow: hidden;
      position: relative;
    }

    .box::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(to right, var(--primary), var(--secondary));
    }

    .hidden {
      display: none !important;
    }

    .logo {
      text-align: center;
      margin-bottom: 30px;
    }

    .logo i {
      font-size: 48px;
      color: var(--primary);
      margin-bottom: 15px;
    }

    .logo h1 {
      color: var(--dark);
      font-size: 28px;
      font-weight: 700;
    }

    .logo p {
      color: var(--gray);
      font-size: 14px;
      margin-top: 5px;
    }

    h2 {
      color: var(--dark);
      text-align: center;
      margin-bottom: 25px;
      font-weight: 600;
    }

    .form-group {
      margin-bottom: 20px;
      position: relative;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--dark);
      font-weight: 500;
      font-size: 14px;
    }

    .input-icon {
      position: relative;
    }

    .input-icon i {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
    }

    input {
      width: 100%;
      padding: 15px 15px 15px 45px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 16px;
      transition: var(--transition);
      background-color: #f9f9f9;
    }

    input:focus {
      outline: none;
      border-color: var(--primary);
      background-color: white;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
    }

    .btn {
      display: block;
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      text-align: center;
      margin-top: 10px;
    }

    .btn-primary {
      background-color: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background-color: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(52, 152, 219, 0.3);
    }

    .btn-secondary {
      background-color: var(--secondary);
      color: white;
    }

    .btn-secondary:hover {
      background-color: var(--secondary-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(46, 204, 113, 0.3);
    }

    .btn-danger {
      background-color: var(--danger);
      color: white;
    }

    .btn-danger:hover {
      background-color: var(--danger-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(231, 76, 60, 0.3);
    }

    .btn-logout {
      width: auto;
      padding: 12px 25px;
      margin: 30px auto 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .btn-logout i {
      font-size: 18px;
    }

    .control-panel {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 30px 0;
    }

    .control-btn {
      width: 130px;
      height: 130px;
      border-radius: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: var(--shadow);
    }

    .control-btn i {
      font-size: 40px;
      margin-bottom: 15px;
    }

    .control-btn span {
      font-size: 18px;
      font-weight: 600;
    }

    .led-on {
      background-color: var(--secondary);
      color: white;
    }

    .led-on:hover {
      background-color: var(--secondary-dark);
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(46, 204, 113, 0.4);
    }

    .led-off {
      background-color: var(--danger);
      color: white;
    }

    .led-off:hover {
      background-color: var(--danger-dark);
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(231, 76, 60, 0.4);
    }

    .status-indicator {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 10px;
    }

    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: var(--gray);
    }

    .status-dot.connected {
      background-color: var(--secondary);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    .status-text {
      font-size: 14px;
      color: var(--dark);
    }

    .footer {
      text-align: center;
      margin-top: 30px;
      color: var(--gray);
      font-size: 14px;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      background-color: white;
      border-radius: 10px;
      box-shadow: var(--shadow), 0 5px 15px rgba(0, 0, 0, 0.1);
      display: flex;
      align-items: center;
      gap: 15px;
      transform: translateX(150%);
      transition: transform 0.5s ease;
      z-index: 1000;
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification-icon {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 14px;
    }

    .notification.success .notification-icon {
      background-color: var(--secondary);
    }

    .notification.error .notification-icon {
      background-color: var(--danger);
    }

    .notification.info .notification-icon {
      background-color: var(--primary);
    }

    .notification-content h4 {
      margin-bottom: 5px;
      color: var(--dark);
    }

    .notification-content p {
      color: var(--gray);
      font-size: 14px;
    }

    @media (max-width: 500px) {
      .container {
        max-width: 100%;
      }
      
      .box {
        padding: 30px 20px;
      }
      
      .control-panel {
        flex-direction: column;
        align-items: center;
      }
      
      .control-btn {
        width: 100%;
        max-width: 200px;
      }
    }
  </style>
</head>
<body>
  <!-- Notification System -->
  <div id="notification" class="notification">
    <div class="notification-icon">
      <i class="fas fa-check"></i>
    </div>
    <div class="notification-content">
      <h4>Notification</h4>
      <p>This is a notification message.</p>
    </div>
  </div>

  <div class="container">
    <!-- Login Page -->
    <div id="loginPage" class="box">
      <div class="logo">
        <i class="fas fa-microchip"></i>
        <h1>IoT Dashboard</h1>
        <p>ESP32 Control Panel</p>
      </div>
      
      <h2>Masuk ke Dashboard</h2>
      
      <div class="form-group">
        <label for="user">Username</label>
        <div class="input-icon">
          <i class="fas fa-user"></i>
          <input type="text" id="user" placeholder="Masukkan username">
        </div>
      </div>
      
      <div class="form-group">
        <label for="pass">Password</label>
        <div class="input-icon">
          <i class="fas fa-lock"></i>
          <input type="password" id="pass" placeholder="Masukkan password">
        </div>
      </div>
      
      <button onclick="login()" class="btn btn-primary">
        <i class="fas fa-sign-in-alt"></i> Login
      </button>
      
      <div class="footer">
      </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboardPage" class="box hidden">
      <div class="logo">
        <i class="fas fa-sliders-h"></i>
        <h1>Kontrol ESP32</h1>
        <p>Dashboard Kontrol Perangkat IoT</p>
      </div>
      
      <h2>Kontrol LED</h2>
      
      <div class="status-indicator">
        <div id="statusDot" class="status-dot"></div>
        <div id="statusText" class="status-text">Menghubungkan ke MQTT...</div>
      </div>
      
      <div class="control-panel">
        <div class="control-btn led-on" onclick="ledOn()">
          <i class="fas fa-lightbulb"></i>
          <span>NYALAKAN</span>
        </div>
        
        <div class="control-btn led-off" onclick="ledOff()">
          <i class="fas fa-power-off"></i>
          <span>MATIKAN</span>
        </div>
      </div>
      
      <button onclick="logout()" class="btn btn-danger btn-logout">
        <i class="fas fa-sign-out-alt"></i> Logout
      </button>
      
      <div class="footer">
        <p>Terhubung ke broker.hivemq.com | Status: <span id="connectionStatus">Menghubungkan...</span></p>
      </div>
    </div>
  </div>

  <script>
    // ===== KONFIG LOGIN =====
    const USERNAME = "admin";
    const PASSWORD = "12345";

    // ===== MQTT =====
    const broker = "wss://broker.hivemq.com:8884/mqtt";
    const topic = "iot/esp32/led";
    let client = null;

    // ===== NOTIFICATION SYSTEM =====
    function showNotification(type, title, message) {
      const notification = document.getElementById("notification");
      const icon = notification.querySelector(".notification-icon i");
      const notificationTitle = notification.querySelector(".notification-content h4");
      const notificationMessage = notification.querySelector(".notification-content p");
      
      // Set notification type
      notification.className = "notification " + type;
      notificationTitle.textContent = title;
      notificationMessage.textContent = message;
      
      // Set icon based on type
      if (type === "success") {
        icon.className = "fas fa-check";
      } else if (type === "error") {
        icon.className = "fas fa-exclamation-triangle";
      } else {
        icon.className = "fas fa-info-circle";
      }
      
      // Show notification
      notification.classList.add("show");
      
      // Hide after 3 seconds
      setTimeout(() => {
        notification.classList.remove("show");
      }, 3000);
    }

    // ===== CEK LOGIN SAAT LOAD =====
    window.onload = () => {
      if (localStorage.getItem("isLogin") === "true") {
        showDashboard();
      } else {
        showLogin();
      }
    };

    function showLogin() {
      document.getElementById("loginPage").classList.remove("hidden");
      document.getElementById("dashboardPage").classList.add("hidden");
      
      // Clear input fields
      document.getElementById("user").value = "";
      document.getElementById("pass").value = "";
      
      // Disconnect MQTT if connected
      if (client) {
        client.end();
        client = null;
      }
    }

    function showDashboard() {
      document.getElementById("loginPage").classList.add("hidden");
      document.getElementById("dashboardPage").classList.remove("hidden");
      connectMQTT();
    }

    function login() {
      const u = document.getElementById("user").value;
      const p = document.getElementById("pass").value;

      if (u === USERNAME && p === PASSWORD) {
        localStorage.setItem("isLogin", "true");
        showNotification("success", "Login Berhasil", "Anda akan diarahkan ke dashboard...");
        
        // Delay to show notification
        setTimeout(() => {
          showDashboard();
        }, 1000);
      } else {
        showNotification("error", "Login Gagal", "Username atau password salah");
        document.getElementById("pass").value = "";
        document.getElementById("pass").focus();
      }
    }

    function logout() {
      showNotification("info", "Logout", "Anda telah logout dari sistem");
      localStorage.removeItem("isLogin");
      
      // Delay to show notification before logout
      setTimeout(() => {
        showLogin();
      }, 1000);
    }

    // ===== MQTT FUNCTION =====
    function connectMQTT() {
      // Update status
      updateConnectionStatus("Menghubungkan...", false);
      
      // Prevent multiple connections
      if (client) {
        client.end();
      }
      
      client = mqtt.connect(broker);
      
      client.on("connect", () => {
        console.log("Web terhubung ke MQTT");
        updateConnectionStatus("Terhubung ke MQTT", true);
        showNotification("success", "MQTT Connected", "Berhasil terhubung ke broker");
      });
      
      client.on("error", (error) => {
        console.error("MQTT Error:", error);
        updateConnectionStatus("Gagal terhubung", false);
        showNotification("error", "MQTT Error", "Gagal terhubung ke broker");
      });
      
      client.on("offline", () => {
        updateConnectionStatus("Offline", false);
        showNotification("error", "MQTT Offline", "Koneksi ke broker terputus");
      });
    }

    function updateConnectionStatus(status, isConnected) {
      const statusDot = document.getElementById("statusDot");
      const statusText = document.getElementById("statusText");
      const connectionStatus = document.getElementById("connectionStatus");
      
      statusText.textContent = status;
      connectionStatus.textContent = status;
      
      if (isConnected) {
        statusDot.classList.add("connected");
      } else {
        statusDot.classList.remove("connected");
      }
    }

    function ledOn() {
      if (client && client.connected) {
        client.publish(topic, "ON");
        showNotification("success", "LED ON", "Perintah ON berhasil dikirim");
        console.log("Mengirim perintah: ON");
      } else {
        showNotification("error", "MQTT Error", "Tidak terhubung ke broker");
      }
    }

    function ledOff() {
      if (client && client.connected) {
        client.publish(topic, "OFF");
        showNotification("success", "LED OFF", "Perintah OFF berhasil dikirim");
        console.log("Mengirim perintah: OFF");
      } else {
        showNotification("error", "MQTT Error", "Tidak terhubung ke broker");
      }
    }
    
    // Add enter key support for login
    document.addEventListener("keydown", function(event) {
      if (event.key === "Enter") {
        if (!document.getElementById("loginPage").classList.contains("hidden")) {
          login();
        }
      }
    });
  </script>
</body>
</html>